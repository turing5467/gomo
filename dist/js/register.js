"use strict";$(function(){Cookie.remove("userId"),$(".inpBtn").click(function(e){e.preventDefault(),$(".popBoxWrapper").css("display","none"),$(document.body).addClass("body")});var t=$("#oPhone"),n=$(".enPhone"),r=$("#oName"),a=$("#oPwd"),e=$("#oVerify"),o=$(".getVerifyCode").eq(0),s=$(".remainSeconds"),i=$(".nextStepBtn").eq(0),p=$(".nextStepBtn").eq(1),u=$(".go-shopping"),d=$(".clearTextBtn"),l=$(".remain-5-seconds"),c=/^1[3-9][0-9]{9}$/,f=/^[a-zA-Z][a-zA-Z0-9]{5,9}$/,g=/^[a-zA-Z0-9]{6,16}$/,m="",x="",v="",C=void 0,h="",w=new Array(2).fill(!1),y=new Array(2).fill(!1);function D(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1e3,a=window.setInterval(function(){e.text(t),0==t&&(clearInterval(a),n&&n()),t--},r)}function k(e,t,n,r){e.some(function(e){return 0==e})||($(t).next().addClass("active"),$(t).siblings(n).addClass("active"),$(r).removeClass("cur").next().addClass("cur"))}t.on("input",function(e){e.preventDefault(),0==(m=t.val().trim()).length?(t.next("span").addClass("err").text("请输入手机号!"),t.parent().addClass("form-group-error"),w[0]=!1):c.test(m)?$.ajax({type:"get",url:"../server/phoneUnique.php",data:{phone:m},success:function(e){0==e?(t.parent().addClass("form-group-error"),w[0]=!1,t.next("span").addClass("err").text("手机号已被注册!")):1==e&&(t.parent().removeClass("form-group-error"),w[0]=!0,t.next("span").addClass("info").text("手机号可用!"),n.text(m))}}):(t.next("span").removeClass("info").addClass("err").text("手机号不存在"),w[0]=!1)}),o.on("click",function(e){var t,n;(e.preventDefault(),0!=w[0])&&(C=e5.getRandom(1e3,9999),$.ajax({type:"post",url:"http://route.showapi.com/28-1",dataType:"json",data:{showapi_timestamp:(t=new Date,n=t.getMonth()+1,t.getFullYear()+""+(10<=n?n:"0"+n)+(t.getDate()<10?"0"+t.getDate():t.getDate())+(t.getHours()<10?"0"+t.getHours():t.getHours())+(t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes())+(t.getSeconds()<10?"0"+t.getSeconds():t.getSeconds())),showapi_appid:"105009",showapi_sign:"51084e3ee1f34d5c86af6e0e3506a8fa",mobile:m,content:'{"code":"'+C+'","minute":"3","comName":"国美商城"}',tNum:"T150606060601"},error:function(e,t,n){alert("操作失败!")},success:function(e){0==e.showapi_res_code&&(w[1]=!0,s.parent().addClass("active"),new Promise(function(e){D(s,59,function(){e()})}).then(function(){s.parent().removeClass("active")}))}}))}),i.click(function(e){e.preventDefault(),k(w,".round-1",".round-2",".round-1-content")}),e.on("input",function(){h=e.val(),w[1]=h==C}),r.on("input",function(e){(x=r.val().trim()).length<6?(r.parent().addClass("form-group-error"),y[0]=!1,r.next("span").addClass("err").text("用户名太短!"),0==x.length&&r.next("span").text("请输入用户名!")):f.test(x)?$.ajax({type:"post",url:"../server/usernameUnique.php",data:{username:x},success:function(e){0==e?(r.parent().addClass("form-group-error"),y[0]=!1,r.next("span").addClass("err").text("用户名已被注册!")):1==e&&(r.parent().removeClass("form-group-error"),y[0]=!0,r.next("span").addClass("info").text("用户名可用!"))}}):(r.parent().removeClass("form-group-error"),y[0]=!1,r.next("span").addClass("err").text("用户名非法!"))}),a.on("input",function(e){var t=!1;(v=a.val().trim()).length<6?(a.parent().addClass("form-group-error"),t=!1,a.next("span").addClass("err").text("请输入6位数以上密码!"),0==v.length&&a.next("span").text("密码不能为空!")):g.test(v)?(a.parent().removeClass("form-group-error"),t=!0,a.next("span").addClass("info").text("密码合格!")):(a.parent().addClass("form-group-error"),t=!1,a.next("span").addClass("err").text("密码不合格!")),y[1]=t}),p.click(function(e){e.preventDefault(),$.ajax({type:"post",url:"../server/register.php",data:{phone:m,username:x,pwd:v},success:function(e){1==e&&(k(y,".round-2",".round-3",".round-2-content"),D(l,4,function(){window.location.href="./login.html"}))}})}),u.click(function(e){e.preventDefault(),window.location.href="./index.html"}),d.click(function(e){e.preventDefault(),$(e.target).siblings("input").val("")})});