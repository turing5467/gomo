"use strict";$(function(){var r=Cookie.get("userId");$.ajax({type:"get",url:"../server/getCart.php",data:{id:r},dataType:"json",async:!1,success:function(o){var s=[];o.forEach(function(e,o){var a=s.findIndex(function(o){return o.shop_name==e[4]});if(-1!=a)s[a].products.push(e);else{var c={};c.shop_name=e[4],c.products=[],c.products.push(e),s.push(c)}}),s.forEach(function(o){return o.products.sort(function(o,e){return o[1]==e[1]?1*o[3]-1*e[3]:o[1]-e[1]})}),s.forEach(function(o){var e,a;e=o,a=$(".cart-list").eq(0),$('<div class="cart-shop-header "></div>').html(function(){return'\n            <div class="cart-col-1">\n                <div class="good-checkboxs-no checkShop" style="margin-top: 13px;">       \n                    <input type="checkbox" style="display: none;">      \n                </div>\n            </div>\n            <div class="cart-col-2">\n                <a href="//mall.gome.com.cn/80006441/" title="永兴电脑专营店" class="black cart-shop-name cart-shop-name-fixed " target="_blank">'+e.shop_name+'</a>                             <span style="display: inline-block" class="cart-kf cart-header-kf customerServiceAshes" data-shopname="'+e.shop_name+'">      \n                    <i style="cursor: pointer;vertical-align: middle;" class="c-i c-kf-on"></i>      \n                    <span class="contact-customer-word contact-font">在线客服</span>\n                </span>\n            </div>\n            '}).appendTo(a),$('<div class="cart-shop-goods cart-shop-goods-normal"></div>').html(function(){return e.products.map(function(o){return'<div class="cart-shop-good clearfix  cart-shop-good-common" id='+o[0]+'>\n                    <div class="cart-col-1 border-top ">\n                        <div class="good-checkboxs-no checkItem">        \n                            <input type="checkbox" name="good" style="display: none;">\n                        </div>\n                    </div>\n                    <div class="cart-col-2" style="height: 82px;">\n                        <a href="./detail.html?code='+o[0]+'" target="_blank" class="g-img">\n                            <img src='+o[2].split(",")[0].replace("_30","_80")+' alt="">           </a>  </div>  <div class="fl">   <div class="clearfix">    <div style="" class="cart-col-3">     <div class="cart-good-name">            <a href="./detail.html?code='+o[0]+'" target="_blank" title="'+o[1]+'">'+o[1]+"("+o[6].split(",")[o[7]-1]+')</a>     </div>     <div class="support-server clearfix">                   <i class="c-i seven border-radius-icon" title="支持7天无理由退货"></i>                 </div>                             </div>                  \n                            <div class="cart-col-8">\n                                <div class="cart-good-pro">\n                                    <div class="cart-saleprops-text">\n                                        <div class="cart-salesPro-item">              <span class="cart-good-key" title="版本">版本</span>                          <span class="cart-good-value" data-type='+o[7]+' title="'+o[6].split(",")[o[7]-1]+'">：'+o[6].split(",")[o[7]-1]+'</span>                      </div>                                        </div>                               <div class="cart-coupon cart-modify-saleprops">                                     <div class="cart-coupon-box" gui-popupbox="">                                          <div class="js-show-salepropsBox">                  </div></div></div></div></div>            \x3c!--sales property --\x3e\n                                        <div class="cart-col-4 cart-price-height47">     <div class="cart-good-real-price " data-price='+o[3]+">             \x3c!--主品--\x3e       ¥&nbsp;"+o[3]+'                    </div>               <div class="red">           </div>             </div>   <div class="cart-col-5">                                                                <div class="gui-count cart-count">\n                                        <a href="javascript:;" class="gui-count-btn gui-count-sub '+("1"==o[8]?"gui-count-disabled":"")+'">-</a>\n                                        <a href="javascript:;" class="gui-count-btn gui-count-add">+</a>\n                                        <div class="gui-count-input">\n                                            <input  class="dytest " type="text" value="'+o[8]+'">\n                                        </div></div>                           </div>  <div class="cart-col-6 ">      <div class="cart-good-amount">    ¥&nbsp;'+(o[3]*o[8]).toFixed(2)+'       </div>    </div>  </div>  <div class="cart-good-box"></div>  </div>  <div class="cart-col-7">       <div class="cart-good-fun delfixed">     <a href="javascript:;" >     删除     </a>    </div>                         </div>          </div>'}).join("")}).appendTo(a)})}}),$.ajaxSetup({url:"../server/addToCart.php",global:!1,type:"POST"});$(".cart-list").eq(0);var d=$(".selected-item").eq(0),n=$(".selected-price").eq(0),o=$(".dytest"),e=$(".gui-count-add"),a=$(".gui-count-sub");o.on("input change",function(o){var e=$(o.target).parents(".cart-shop-good").attr("id"),a=$(o.target).val()-0,c=$(o.target).parents(".cart-shop-good").find(".cart-good-value").data("type")-0,s=$(o.target).parents(".cart-shop-good").find(".cart-good-real-price").data("price");$(o.target).parents(".cart-shop-good").find(".cart-good-amount").text("¥ "+(a*s).toFixed(2)),$.ajax({data:{id:r,product_code:e,num:a,type:c,flag:1}}),d.text(p()),n.text("￥"+h())}),e.click(function(o){$(o.target).parent().find(".gui-count-sub").removeClass("gui-count-disabled");var e=$(o.target).parent().find(".dytest").eq(0);e.val(1*e.val()+1);var a=1*e.val(),c=$(o.target).parents(".cart-shop-good").attr("id"),s=$(o.target).parents(".cart-shop-good").find(".cart-good-value").data("type")-0;$.ajax({data:{id:r,product_code:c,num:a,type:s,flag:1}});var t=$(o.target).parents(".cart-shop-good").find(".cart-good-real-price").data("price");$(o.target).parents(".cart-shop-good").find(".cart-good-amount").text("¥ "+(a*t).toFixed(2)),d.text(p()),n.text("￥"+h())}),a.click(function(o){var e=void 0,a=$(o.target).parent().find(".dytest").eq(0);if(1<a.val()){a.val(a.val()-1),e=1*a.val();var c=$(o.target).parents(".cart-shop-good").attr("id"),s=$(o.target).parents(".cart-shop-good").find(".cart-good-value").data("type")-0;$.ajax({data:{id:r,product_code:c,num:e,type:s,flag:1}})}else a.val(1);1==(e=a.val())&&$(o.target).addClass("gui-count-disabled");var t=$(o.target).parents(".cart-shop-good").find(".cart-good-real-price").data("price");$(o.target).parents(".cart-shop-good").find(".cart-good-amount").text("¥ "+(e*t).toFixed(2)),d.text(p()),n.text("￥"+h())}),$(".delfixed").click(function(o){if(confirm("确定要删除选中商品吗?")){var e=$(o.target).parents(".cart-shop-good").eq(0),a=$(o.target).parents(".cart-shop-goods").eq(0),c=e.attr("id"),s=e.find(".cart-good-value").data("type")-0;$.ajax({url:"../server/deleteFromCart.php",data:{id:r,product_code:c,type:s},success:function(o){o&&(e.remove(),0==a.children().length&&(a.prev().remove(),a.remove()))}})}}),$(".del-goods").click(function(o){confirm("确定要删除选中商品吗?")&&($(".cart-shop-goods").find(".checkbox_chose").each(function(o,e){var a=$(e).parents(".cart-shop-good").eq(0),c=$(e).parents(".cart-shop-goods").eq(0),s=a.attr("id"),t=a.find(".cart-good-value").data("type")-0;$.ajax({url:"../server/deleteFromCart.php",data:{id:r,product_code:s,type:t},success:function(o){o&&(a.remove(),0==c.children().length&&(c.prev().remove(),c.remove()))}})}),d.text(p()),n.text("￥"+h()))});var t=$(".checkAll"),c=$(".checkShop"),s=$(".checkItem"),i=Array.from(c),l=Array.from(s);function p(){var a=0;return s.each(function(o,e){$(e).is(".checkbox_chose")&&(a+=1*$(e).parents(".cart-shop-good").find(".dytest").eq(0).val())}),a}function h(){var a=0;return s.each(function(o,e){$(e).is(".checkbox_chose")&&(a+=1*$(e).parents(".cart-shop-good").find(".cart-good-amount").eq(0).text().trim().slice(2))}),a.toFixed(2)}t.on("click",function(o){$(o.target).hasClass("checkbox_chose")?(t.addClass("good-checkboxs-no").removeClass("c-i").removeClass("checkbox_chose"),c.addClass("good-checkboxs-no").removeClass("c-i").removeClass("checkbox_chose"),s.addClass("good-checkboxs-no").removeClass("c-i").removeClass("checkbox_chose")):(t.addClass("c-i checkbox_chose").removeClass("good-checkboxs-no"),c.addClass("c-i checkbox_chose").removeClass("good-checkboxs-no"),s.addClass("c-i checkbox_chose").removeClass("good-checkboxs-no")),d.text(p()),n.text("￥"+h())}),c.on("click",function(o){var e=$(o.target).parent().find(".checkShop"),a=e.hasClass("checkbox_chose"),c=e.parents(".cart-shop-header").next().find(".checkItem");a?(e.addClass("good-checkboxs-no").removeClass("c-i").removeClass("checkbox_chose"),c.addClass("good-checkboxs-no").removeClass("c-i").removeClass("checkbox_chose")):(e.removeClass("good-checkboxs-no").addClass("c-i checkbox_chose"),c.addClass("c-i checkbox_chose").removeClass("good-checkboxs-no")),i.every(function(o){return $(o).is(".checkbox_chose")})?t.addClass("c-i checkbox_chose").removeClass("good-checkboxs-no"):i.some(function(o){return $(o).is(".good-checkboxs-no")})&&t.addClass("good-checkboxs-no").removeClass("c-i").removeClass("checkbox_chose"),d.text(p()),n.text("￥"+h())}),s.on("click",function(o){var e=$(o.target),a=$(o.target).hasClass("checkbox_chose"),c=Array.from(e.parents(".cart-shop-goods").find(".checkItem")),s=e.parents(".cart-shop-goods").prev().find(".checkShop");a?e.addClass("good-checkboxs-no").removeClass("c-i").removeClass("checkbox_chose"):e.addClass("c-i checkbox_chose").removeClass("good-checkboxs-no"),c.every(function(o){return $(o).is(".checkbox_chose")})?(s.addClass("c-i checkbox_chose").removeClass("good-checkboxs-no"),l.every(function(o){return $(o).is(".checkbox_chose")})&&t.addClass("c-i checkbox_chose").removeClass("good-checkboxs-no")):c.some(function(o){return $(o).is(".good-checkboxs-no")})&&(s.addClass("good-checkboxs-no").removeClass("c-i").removeClass("checkbox_chose"),t.addClass("good-checkboxs-no").removeClass("c-i").removeClass("checkbox_chose")),d.text(p()),n.text("￥"+h())})});